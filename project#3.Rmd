---
title: "project4"
output: pdf_document
---

```{r setup, include=TRUE}
library(dplyr)
library(tidyverse)
library(ggplot2)
library(gapminder)
library(broom)
data(gapminder)

gapminder
```

Exerciese 1:

```{r}
gapminder %>%
  ggplot(mapping=aes(x=year,y=lifeExp)) +
  geom_point()
```

Question 1:

The general trend is increasing for life expectancy across time. It is linear.
```{r}
gapminder %>%
  ggplot(aes(x=factor(year), y=lifeExp)) +
  geom_violin() +
  geom_boxplot(width=.1) +
  labs(title="Life expectancy over time",
         x = "year",
         y = "life expectancy")
```

Question 2:

Nearly all of them are skewed. It goes from bottom heavy to top heavy. In the early year, the life expectancy is not unimodal (from 1952 to 1977). Then it starts to be unimodal. For all years, it is not symmetric around its center.

Question 3:

I will reject the null hypothesis based on my intuition, since it seems that there's a linear relationship between year and life expectancy.

Question 4:

I think the residuals will also be linear concerning the year.

Question 5:

The plot of the residuals should be centered around 0 when a linear model is fitted to the data with linear relationship.

Exercise 2:

```{r}
gapminder %>%
  ggplot(aes(x=year, y=lifeExp)) +
    geom_point() +
    geom_smooth(method=lm)

ex2 <- lm(lifeExp~year, data = gapminder) 
ex2_res <- ex2 %>%
  tidy()

ex2_res

```

Question 6:

On average, life expectancy increases by 0.3259038 years every year around the world.

Question 7:

We reject the null hypothesis of no relationship between year and life expectancy, because p value is 7.546795e-80, which is very low.

Exercise 3:

```{r}
ex2 %>%
  broom::augment() %>%
  ggplot(aes(x = factor(year), y = .resid)) +
  geom_violin() +
  labs(title="Residuals by time",
         x = "year",
         y = "residual")

```

Question 8:

Yes, the plot is indeed centered around 0.

Exercise 4:

```{r}
ex2 %>%
  augment() %>%
  mutate(continent = gapminder$continent) %>%
  ggplot(aes(x=factor(continent), y=.resid)) +
    geom_boxplot() +
    labs(title="Residuals over continents",
         x = "continent",
         y = "residual")
```

Question 9:

Yes, tehre is. For different continents, the residuals are highly different. I suggest that we consider continent as coefficient too.

Exercise 5:
```{r}
gapminder %>%
  ggplot(aes(x=year, y=lifeExp, color=continent)) + 
  geom_point() + 
  geom_smooth(method=lm)
```

Question 10:

Yes. The coefficents for linear model of each continent have difference. The slope of Asia is much larger than Africa.

Exercise 6:

```{r}
ex6 <- lm(lifeExp~continent*year, data=gapminder) 
ex6_res <- ex6 %>%
  tidy()

ex6_res
```

Question 11:

Yes, all of them are different than 0. But some of them are close to 0.continentAsia:year is significantly different from 0.

Question 12:

```{r}
data.frame(continent=
             c("America","Asia","Europe","Oceania"),
           estimate=c(ex6_res$estimate[7:10]+ex6_res$estimate[6]))
```

Exercise 7:
```{r}
anova(ex2)

anova(ex6)
```

Question 13:

It is better than the year-only model. The residuals decrease from 230229 to 87320, which shows that the interaction model can describe the trend and patterns better, with less residuals.

Exercise 8:
```{r}
ex6 %>%
  augment() %>%
  ggplot(aes(x=factor(year), y=.resid)) +
    geom_violin() +
    labs(title="Residuals vs. year, interaction model",
         x = "continent",
         y = "residual")
```
It centers at 0, which means that it matches our linear regression model.

```{r}
ex6 %>%
  augment() %>%
  ggplot(aes(x=.fitted,y=.resid))+geom_violin()+
      labs(title="Residual over fitted",
      x = ".fitted",
      y = ".resid")
```

The residuals center at 0, so it mathes the assumptions of linear models.